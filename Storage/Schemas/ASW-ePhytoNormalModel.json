{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ASW E-Phyto Normal Status Schema (851) - Comprehensive Validation Version",
  "type": "object",
  "properties": {
    "xc_document": {
      "type": ["object"],
      "properties": {
        "doc_name": { "type": ["string"] },
        "doc_id": { "type": ["string", "integer"] },
        "doc_description": { "type": ["string"] },
        "doc_type": { "type": ["string", "integer"], "enum": ["851", 851] },
        "status_code": { "type": ["string", "integer"], "enum": ["70", 70] },
        "issue_date": { "type": ["string"] },
        "issue_party_id": { "type": ["string", "integer"] },
        "issue_party_name": { "type": ["string"] },
        "include_notes": {
          "type": ["array"],
          "minItems": 1,
          "items": {
            "type": "object",
            "properties": {
              "subject": { "type": ["string"] },
              "contents": {
                "type": ["array"],
                "minItems": 1,
                "items": {
                  "type": "object",
                  "properties": { "content": { "type": ["string", "integer"] } },
                  "required": ["content"]
                }
              }
            },
            "required": ["subject", "contents"],
            "allOf": [
              {
                "if": { "properties": { "subject": { "enum": ["SPSFL", "DMCL"] } } },
                "then": { "properties": { "contents": { "maxItems": 1 } } }
              }
            ]
          }
        },
        "reference_docs": {
          "type": ["array"],
          "items": {
            "type": "object",
            "properties": {
              "relation_type_code": { "type": ["string"] },
              "doc_id": { "type": ["string", "integer"] },
              "PdfObject": { 
                "type": ["string"],
                "contentEncoding": "base64",
                "contentMediaType": "application/pdf"
              },
              "filename": { "type": ["string"] }
            },
            "required": ["relation_type_code", "doc_id", "PdfObject", "filename"]
          }
        },
        "signatory_authen": {
          "type": ["object"],
          "properties": {
            "actual_datetime": { "type": ["string"] },
            "issue_location": {
              "type": ["object", "string"],
              "properties": { "name": { "type": ["string"] } },
              "required": ["name"]
            },
            "provider_party": {
              "type": ["object"],
              "properties": {
                "name": { "type": ["string"] },
                "specfied_person": {
                  "type": ["object"],
                  "properties": {
                    "name": { "type": ["string"] },
                    "attained_qualification": {
                      "type": ["object"],
                      "properties": { "name": { "type": ["string"] } },
                      "required": ["name"]
                    }
                  },
                  "required": ["name"]
                }
              },
              "required": ["name"]
            },
            "include_clauses": {
              "type": ["array"],
              "items": {
                "type": "object",
                "properties": { "id": { "type": ["string", "integer"] }, "content": { "type": ["string"] } },
                "required": ["id", "content"]
              }
            }
          },
          "required": ["actual_datetime", "issue_location", "provider_party", "include_clauses"]
        }
      },
      "required": ["doc_name", "doc_id", "doc_type", "status_code", "issue_date", "issue_party_name", "include_notes", "signatory_authen"]
    },
    "consignment": {
      "type": ["object"],
      "properties": {
        "consignor_party": {
          "type": ["object"],
          "properties": { "name": { "type": ["string"] }, "adress_line1": { "type": ["string"] } },
          "required": ["name", "adress_line1"]
        },
        "consignee_party": {
          "type": ["object"],
          "properties": { "name": { "type": ["string"] }, "adress_line1": { "type": ["string"] } },
          "required": ["name", "adress_line1"]
        },
        "export_country": {
          "type": ["object"],
          "properties": {
            "id": { "type": ["string"] },
            "name": { "type": ["string"] },
            "subordinary": {
              "type": ["object"],
              "properties": { "name": { "type": ["string"] }, "hierachi_level": { "type": ["string", "integer"] } },
              "required": ["name", "hierachi_level"]
            }
          },
          "required": ["id", "name"]
        },
        "import_country": {
          "type": ["object"],
          "properties": { "id": { "type": ["string"] }, "name": { "type": ["string"] } },
          "required": ["id", "name"]
        },
        "examination_event": {
          "type": ["object"],
          "properties": { "occur_location_name": { "type": ["string"] } },
          "required": ["occur_location_name"]
        }
      },
      "required": ["consignor_party", "consignee_party", "export_country", "import_country", "examination_event"]
    },
    "items": {
      "type": ["array"],
      "minItems": 1,
      "items": {
        "type": "object",
        "properties": {
          "descriptions": {
            "type": ["array"],
            "minItems": 1,
            "items": { "type": "object", "properties": { "name": { "type": ["string"] } }, "required": ["name"] }
          },
          "intend_uses": {
            "type": ["array"],
            "minItems": 1,
            "items": { "type": "object", "properties": { "name": { "type": ["string"] } }, "required": ["name"] }
          },
          "net_weight": {
            "type": ["object"],
            "properties": { "weight": { "type": ["string", "number"] }, "unit_code": { "type": ["string"] } },
            "required": ["weight", "unit_code"]
          },
          "gross_weight": {
            "type": ["object"],
            "properties": { "weight": { "type": ["string", "number"] }, "unit_code": { "type": ["string"] } },
            "required": ["weight", "unit_code"]
          },
          "net_volume": {
            "type": ["object"],
            "properties": { "volume": { "type": ["string", "number"] }, "unit_code": { "type": ["string"] } },
            "required": ["volume", "unit_code"]
          },
          "gross_volume": {
            "type": ["object"],
            "properties": { "volume": { "type": ["string", "number"] }, "unit_code": { "type": ["string"] } },
            "required": ["volume", "unit_code"]
          },
          "additional_notes": {
            "type": ["array"],
            "items": {
              "type": "object",
              "properties": {
                "subject": { "type": ["string"] },
                "contents": { "type": ["array"], "minItems": 1 }
              },
              "required": ["subject", "contents"],
              "allOf": [
                {
                  "if": { "properties": { "subject": { "enum": ["OPTND", "OQV", "OQU", "ADIPTLIL", "ADDITLIL"] } } },
                  "then": { "properties": { "contents": { "maxItems": 1 } } }
                }
              ]
            }
          },
          "applicable_classifications": {
            "type": ["array"],
            "items": {
              "type": "object",
              "properties": {
                "system_name": { "type": ["string"] },
                "class_code": { "type": ["string", "integer"] },
                "class_names": {
                  "type": ["array"],
                  "minItems": 1,
                  "items": { "type": "object", "properties": { "class_name": { "type": ["string"] } }, "required": ["class_name"] }
                }
              },
              "required": ["system_name", "class_code", "class_names"],
              "allOf": [
                {
                  "if": { "properties": { "system_name": { "const": "HS" } } },
                  "then": { "properties": { "class_names": { "maxItems": 1 } } }
                }
              ]
            }
          },
          "physical_packages": {
            "type": ["array"],
            "items": {
              "type": "object",
              "properties": {
                "level_code": { "type": ["string", "integer"] },
                "type_code": { "type": ["string", "integer"] },
                "quantity": { "type": ["string", "integer"] },
                "shipping_marks": { "type": ["array"] }
              },
              "required": ["level_code", "type_code", "quantity"]
            }
          },
          "origin_countries": {
            "type": ["array"],
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": ["string"] },
                "name": { "type": ["string"] },
                "subordinary_country": {
                  "type": ["object"],
                  "properties": {
                    "subdivision_name": { "type": ["string"] },
                    "hierachi_level": { "type": ["string", "integer"] },
                    "activity_authorize": {
                        "type": ["object"],
                        "properties": { "party_name": { "type": ["string"] } },
                        "required": ["party_name"]
                    }
                  },
                  "required": ["subdivision_name", "hierachi_level"]
                }
              },
              "required": ["id", "name"]
            }
          },
          "origin_location": {
            "type": ["object"],
            "properties": { "name": { "type": ["string"] } },
            "required": ["name"]
          },
          "applied_processes": {
            "type": ["array"],
            "items": {
              "type": "object",
              "properties": {
                "type_code": { "type": ["string", "integer"] },
                "complete_period": {
                  "type": ["object"],
                  "properties": { "start_date": { "type": ["string"] } },
                  "required": ["start_date"]
                },
                "duration_measuer_unit": { "type": ["string"] },
                "characteristics": {
                  "type": ["array"],
                  "items": {
                    "type": "object",
                    "anyOf": [
                      { "properties": { "desc_1": { "type": ["string"] }, "deec_2": { "type": ["string", "array"] } }, "required": ["desc_1", "deec_2"] }
                    ]
                  }
                }
              },
              "required": ["type_code", "duration_measuer_unit"]
            }
          }
        },
        "required": ["descriptions", "intend_uses"]
      }
    }
  },
  "required": ["xc_document", "consignment", "items"]
}
